<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Banco Gon√ßalo - App Final</title>
<style>
:root {
  --bg-color:#f5f5f7; 
  --text-color:#333; 
  --primary-color:#d71c1c; 
  --secondary-color:#a80000; 
  --card-bg:#fff; 
  --input-bg:#f9f9f9;
}
body.dark-mode {
  --bg-color:#1a1a1a; 
  --text-color:#eee; 
  --card-bg:#222; 
  --input-bg:#333;
}
*{margin:0;padding:0;box-sizing:border-box;}
body, html{font-family:'Helvetica Neue',Arial,sans-serif;background:var(--bg-color);color:var(--text-color);}
.app{max-width:420px;margin:auto;padding:15px;}
.header{background:var(--primary-color);color:white;padding:35px 25px;border-radius:30px;text-align:center;margin-bottom:20px;box-shadow:0 5px 25px rgba(0,0,0,0.25);}
.header h1{font-size:28px;font-weight:700;text-shadow:1px 1px 2px rgba(0,0,0,0.2);}
.header p{margin-top:6px;font-size:16px;opacity:0.9;}
.tabs, .sub-aba-mes, .sub-aba-filtro {
  display:flex;
  flex-wrap:wrap;
  justify-content:space-around;
  margin-bottom:15px;
}
.tab-button, .sub-aba-mes button, .sub-aba-filtro button{
  padding:10px 12px;
  border:none;
  border-radius:12px;
  background:#ddd;
  cursor:pointer;
  font-weight:600;
  margin:3px;
  transition:all 0.3s;
}
.tab-button.active, .sub-aba-mes button.active, .sub-aba-filtro button.active{
  background:var(--primary-color);
  color:white;
  box-shadow:0 3px 10px rgba(0,0,0,0.2);
}
.card{border-radius:22px;padding:18px 20px;margin-bottom:15px;box-shadow:0 5px 18px rgba(0,0,0,0.1);position:relative;transition:all 0.3s;background:var(--card-bg);}
.total-card{background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:white;text-align:center;animation:pulse 2s infinite;}
.total-card h2{font-size:32px;font-weight:700;margin-top:8px;}
.card.small{display:flex;justify-content:space-between;padding:14px 18px;background:var(--card-bg);border-radius:18px;box-shadow:0 4px 14px rgba(0,0,0,0.06);margin-bottom:12px;}
.card.small span{font-size:14px;font-weight:500;color:var(--text-color);}
.card.small strong{font-size:16px;font-weight:600;color:var(--primary-color);}
.list h3{margin-bottom:12px;font-size:20px;color:var(--primary-color);font-weight:600;}
.item{display:flex;justify-content:space-between;align-items:center;background:var(--card-bg);padding:14px 18px;border-radius:18px;margin-bottom:10px;box-shadow:0 3px 10px rgba(0,0,0,0.08);position:relative;}
.item:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,0.12);}
.item span{font-size:16px;font-weight:500;}
.item input{width:90px;text-align:right;border:none;font-size:16px;font-weight:600;border-radius:8px;padding:5px;transition:all 0.2s;background:var(--input-bg);}
.item input:focus{outline:none;background:var(--card-bg);box-shadow:0 0 5px rgba(0,0,0,0.15);}
.item.positivo input{color:green;}
.item.negativo input{color:red;}
.divider{height:1px;background:#eee;margin:15px 0;}
@keyframes pulse{0%{box-shadow:0 0 0 rgba(215,28,28,0.4);}70%{box-shadow:0 0 20px rgba(215,28,28,0.4);}100%{box-shadow:0 0 0 rgba(215,28,28,0.4);}}
#grafico-container{background:var(--card-bg);padding:15px;border-radius:20px;box-shadow:0 4px 14px rgba(0,0,0,0.06);margin-top:20px;}
.add-button{background:var(--primary-color);color:white;border:none;padding:8px 12px;border-radius:12px;font-weight:600;cursor:pointer;margin:10px 0;transition:0.3s;}
.add-button:hover{background:var(--secondary-color);}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:6px 8px;text-align:left;}
th{border-bottom:2px solid var(--primary-color);}
.dark-mode-button{position:fixed;top:10px;right:10px;padding:8px 12px;border:none;border-radius:12px;background:#444;color:white;cursor:pointer;z-index:999;}
@media screen and (max-width:450px){.app{padding:10px;}.item input{width:75px;font-size:14px;}}
</style>
</head>
<body>
<button class="dark-mode-button" onclick="toggleDarkMode()">üåì Dark Mode</button>
<div class="app">
<header class="header">
  <h1>Ol√° Gon√ßalo!</h1>
  <p>Bem-vindo ao seu Banco</p>
</header>

<!-- Abas principais -->
<div class="tabs">
  <button class="tab-button active" onclick="abrirAba('saldos', this)">Saldos</button>
  <button class="tab-button" onclick="abrirAba('movimentos', this)">Movimentos</button>
  <button class="tab-button" onclick="abrirAba('planeamento', this)">Planeamento</button>
</div>

<!-- SALDOS -->
<div id="saldos" class="tab-content">
  <section class="card total-card">
    <span>Total geral</span>
    <h2>‚Ç¨ <span id="total">0.00</span></h2>
  </section>
  <section class="card small"><span>Sem moedas</span><strong>‚Ç¨ <span id="sem-moedas">0.00</span></strong></section>
  <section class="card small"><span>Sem moedas e sem cart√£o</span><strong>‚Ç¨ <span id="sem-moedas-cartao">0.00</span></strong></section>
  <div class="divider"></div>
  <section class="list" id="lista-saldos"><h3>Saldos</h3></section>
  <div id="grafico-container"><canvas id="saldoGrafico" width="400" height="200"></canvas></div>
</div>

<!-- MOVIMENTOS -->
<div id="movimentos" class="tab-content" style="display:none;">
  <button class="add-button" onclick="mostrarFormMovimento()">+ Adicionar Movimento</button>
  <div id="novo-movimento" style="display:none;margin-top:10px;">
    <label>Tipo:</label>
    <select id="tipo-movimento">
      <option value="ganho">Ganho</option>
      <option value="gasto">Gasto</option>
    </select>
    <label>Valor (‚Ç¨):</label>
    <input type="number" id="valor-movimento">
    <label>Descri√ß√£o:</label>
    <input type="text" id="descricao-movimento">
    <label>Aba:</label>
    <select id="aba-movimento"></select>
    <label>Data (opcional):</label>
    <input type="date" id="data-movimento">
    <button class="add-button" onclick="adicionarMovimento()">Salvar Movimento</button>
  </div>
  
  <div class="divider"></div>
  
  <label>Filtrar por m√™s:</label>
  <div class="sub-aba-mes" id="sub-abas-meses"></div>
  
  <label>Filtrar por aba:</label>
  <div class="sub-aba-filtro" id="sub-abas-filtro"></div>
  
  <div id="lista-movimentos-mensal" style="margin-top:10px;"></div>
</div>

<!-- PLANEAMENTO -->
<div id="planeamento" class="tab-content" style="display:none;">
  <label>Selecione Aba:</label>
  <select id="planeamento-aba" onchange="mostrarPlaneamento(this.value)">
    <option value="Money 2026">Money 2026</option>
    <option value="Dela">Dela</option>
  </select>
  <div id="tabela-planeamento"></div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ================= DARK MODE =================
function toggleDarkMode(){
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}
if(localStorage.getItem('darkMode')==='true') document.body.classList.add('dark-mode');

// ================= INICIALIZA√á√ÉO =================
let abas = JSON.parse(localStorage.getItem('abas')) || {
    "Ibiza":245,"Dela":4010,"Money 2026":2775,"Notas de 5 (capa)":100,
    "Capa 1 (azul)":50,"Capa 2 (caixa Apple)":55,"Porta cart√µes":25,
    "Capa 3 (preta MagSafe)":50,"Cart√£o":19.62,"Capa 4 (iPhone 13)":60,
    "Capa 5 (azul)":15,"Capa Apple Azul Escura":0,"Moedas carteira":131.92
};
localStorage.setItem('abas', JSON.stringify(abas));
let movimentos = JSON.parse(localStorage.getItem('movimentos')) || {};
let extrasAbas = ["Av√¥","Pais"];
let saldoGrafico;

// ================= FUN√á√ïES =================
function abrirAba(id, btn){
  document.querySelectorAll('.tab-content').forEach(tab=>tab.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
  if(btn) btn.classList.add('active');
}

function atualizarTotais(){
  let total=0, semMoedas=0, semCartao=0;
  for(const nome in abas){
    total+=abas[nome];
    if(nome!=="Moedas carteira") semMoedas+=abas[nome];
    if(nome!=="Moedas carteira" && nome!=="Cart√£o") semCartao+=abas[nome];
  }
  document.getElementById('total').textContent = total.toFixed(2);
  document.getElementById('sem-moedas').textContent = semMoedas.toFixed(2);
  document.getElementById('sem-moedas-cartao').textContent = semCartao.toFixed(2);
  localStorage.setItem('abas',JSON.stringify(abas));
}

function atualizarSaldosLista(){
  const lista=document.getElementById('lista-saldos');
  lista.innerHTML='<h3>Saldos</h3>';
  for(const nome in abas){
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`<span>${nome}</span><input type="number" value="${abas[nome].toFixed(2)}" data-nome="${nome}" oninput="atualizarSaldo(this)">`;
    lista.appendChild(div);
  }
  atualizarTotais();
  atualizarGrafico();
}

function atualizarSaldo(input){
  const nome=input.dataset.nome;
  abas[nome]=parseFloat(input.value)||0;
  atualizarTotais();
  atualizarGrafico();
  localStorage.setItem('abas', JSON.stringify(abas));
}

function atualizarGrafico(){
  const ctx=document.getElementById('saldoGrafico').getContext('2d');
  const labels=Object.keys(abas);
  const data=Object.values(abas);
  if(saldoGrafico) saldoGrafico.destroy();
  saldoGrafico=new Chart(ctx,{
    type:'bar',
    data:{labels:labels,datasets:[{label:'Saldo (‚Ç¨)',data:data,backgroundColor:'rgba(215,28,28,0.7)'}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
}

// ================ MOVIMENTOS ==================
function mostrarFormMovimento(){
  const form=document.getElementById('novo-movimento');
  form.style.display=form.style.display==='none'?'block':'none';
}

function preencherSelectAbas(){
  const s=document.getElementById('aba-movimento'); s.innerHTML='';
  Object.keys(abas).forEach(n=>{
    let o=document.createElement('option'); o.value=n; o.textContent=n; s.appendChild(o);
  });
  extrasAbas.forEach(e=>{
    let o=document.createElement('option'); o.value=e; o.textContent=e; s.appendChild(o);
  });
}

function preencherFiltroAbas(){
  const container=document.getElementById('sub-abas-filtro');
  container.innerHTML='';
  const todas=document.createElement('button'); todas.textContent='Todas'; todas.classList.add('active');
  todas.onclick=()=>selecionarFiltroAba(todas); container.appendChild(todas);
  Object.keys(abas).forEach(n=>{
    let b=document.createElement('button'); b.textContent=n; b.onclick=()=>selecionarFiltroAba(b); container.appendChild(b);
  });
  extrasAbas.forEach(e=>{
    let b=document.createElement('button'); b.textContent=e; b.onclick=()=>selecionarFiltroAba(b); container.appendChild(b);
  });
}

function selecionarFiltroAba(botao){
  document.querySelectorAll('#sub-abas-filtro button').forEach(b=>b.classList.remove('active'));
  botao.classList.add('active');
  mostrarMovimentosMesAtual();
}

function atualizarSubAbasMensais(){
  const c = document.getElementById('sub-abas-meses');
  c.innerHTML = '';
  const meses = Object.keys(movimentos).length ? Object.keys(movimentos).sort() : [new Date().toISOString().slice(0,7)];
  
  meses.forEach((m,index)=>{
    const b = document.createElement('button');
    b.textContent = m;
    b.onclick = () => {
      mostrarMovimentosMes(m);
      Array.from(c.querySelectorAll('button')).forEach(btn => btn.classList.remove('active'));
      b.classList.add('active');
    };
    if(index === meses.length-1) b.classList.add('active');
    c.appendChild(b);
  });
}

function mostrarMovimentosMesAtual(){
  const mesBotao = Array.from(document.querySelectorAll('#sub-abas-meses button')).find(b=>b.classList.contains('active'));
  if(mesBotao) mostrarMovimentosMes(mesBotao.textContent);
}

function mostrarMovimentosMes(m){
  const abaFiltro = document.querySelector('#sub-abas-filtro button.active').textContent;
  const c = document.getElementById('lista-movimentos-mensal');
  document.querySelectorAll('#sub-abas-meses button').forEach(b=>b.classList.remove('active'));
  const btn = Array.from(document.querySelectorAll('#sub-abas-meses button')).find(b=>b.textContent===m); 
  if(btn) btn.classList.add('active');

  let totalGanhos=0, totalGastos=0;
  c.innerHTML=`<h4>Movimentos de ${m}</h4>`;
  if(!movimentos[m] || movimentos[m].length===0){c.innerHTML+='<p>Nenhum movimento neste m√™s.</p>'; return;}

  movimentos[m].forEach((x,index)=>{
    if(abaFiltro!=='Todas' && x.aba!==abaFiltro) return;
    const d=document.createElement('div'); 
    d.className='item '+(x.tipo==='gasto'?'negativo':'positivo');
    d.innerHTML=`<span>${x.data} - ${x.aba} - ${x.desc}</span>
                 <input type="text" value="${x.tipoValor.toFixed(2)} ‚Ç¨" readonly>
                 <button class="add-button" style="background:#888;margin-left:10px;padding:3px 6px;font-size:12px;" onclick="apagarMovimento('${m}',${index})">-</button>`;
    c.appendChild(d);
    if(x.tipo==='gasto') totalGastos+=x.valor; else totalGanhos+=x.valor;
  });

  const resumo=document.createElement('div'); 
  resumo.className='card small'; 
  resumo.style.display='flex'; 
  resumo.style.justifyContent='space-between'; 
  resumo.style.marginTop='10px';
  resumo.innerHTML=`<span>Total Entradas: ${totalGanhos.toFixed(2)} ‚Ç¨ | Total Sa√≠das: ${totalGastos.toFixed(2)} ‚Ç¨ | Saldo do M√™s: ${(totalGanhos-totalGastos).toFixed(2)} ‚Ç¨</span>`;
  c.appendChild(resumo);
}

function adicionarMovimento(){
  const tipo = document.getElementById('tipo-movimento').value;
  const valor = parseFloat(document.getElementById('valor-movimento').value);
  const aba = document.getElementById('aba-movimento').value;
  const desc = document.getElementById('descricao-movimento').value;
  let data = document.getElementById('data-movimento').value || new Date().toISOString().slice(0,10);

   if(!valor || !desc) { alert('Preencha todos os campos!'); return; }

  const mes = data.slice(0,7); // Ano-M√™s
  if(!movimentos[mes]) movimentos[mes] = [];
  
  const tipoValor = tipo==='gasto' ? -valor : valor;
  movimentos[mes].push({tipo, valor, aba, desc, data, tipoValor});

  // Atualizar saldo se n√£o for extra
  if(!extrasAbas.includes(aba)){
    abas[aba] += tipoValor;
  }

  localStorage.setItem('movimentos', JSON.stringify(movimentos));
  localStorage.setItem('abas', JSON.stringify(abas));

  // Reset form
  document.getElementById('valor-movimento').value = '';
  document.getElementById('descricao-movimento').value = '';
  document.getElementById('data-movimento').value = '';
  mostrarFormMovimento();

  atualizarTotais();
  atualizarGrafico();
  atualizarSaldosLista();
  atualizarSubAbasMensais();
  mostrarMovimentosMesAtual();
}

function apagarMovimento(mesAno,index){
  if(!confirm('Tem a certeza que quer apagar este movimento?')) return;
  const mov = movimentos[mesAno][index];
  if(!extrasAbas.includes(mov.aba)){
    abas[mov.aba]-=(mov.tipo==='gasto'?-mov.valor:mov.valor);
  }
  movimentos[mesAno].splice(index,1);
  if(movimentos[mesAno].length===0) delete movimentos[mesAno];
  localStorage.setItem('movimentos', JSON.stringify(movimentos));
  atualizarTotais();
  atualizarGrafico();
  atualizarSaldosLista();
  atualizarSubAbasMensais();
  mostrarMovimentosMesAtual();
}

// ================ PLANEAMENTO ==================
const planeamentoData={
  "Money 2026":[
    {mes:'Janeiro',entradas:60,gastos:120,saldo:2835},
    {mes:'Fevereiro',entradas:50,gastos:0,saldo:2885},
    {mes:'Mar√ßo',entradas:50,gastos:0,saldo:2935},
    {mes:'Abril',entradas:60,gastos:70,saldo:2925},
    {mes:'Maio',entradas:50,gastos:0,saldo:2975},
    {mes:'Junho',entradas:350,gastos:80,saldo:3245},
    {mes:'Julho',entradas:60,gastos:90,saldo:3215},
    {mes:'Agosto',entradas:60,gastos:90,saldo:3185},
    {mes:'Setembro',entradas:50,gastos:70,saldo:3165},
    {mes:'Outubro',entradas:50,gastos:0,saldo:3215},
    {mes:'Novembro',entradas:50,gastos:0,saldo:3265},
    {mes:'Dezembro',entradas:600,gastos:120,saldo:3745}
  ],
  "Dela":[
    {mes:'Janeiro',entradas:0,gastos:0,saldo:4010},
    {mes:'Fevereiro',entradas:0,gastos:0,saldo:4010},
    {mes:'Mar√ßo',entradas:0,gastos:0,saldo:4010},
    {mes:'Abril',entradas:0,gastos:70,saldo:3940},
    {mes:'Maio',entradas:0,gastos:0,saldo:3940},
    {mes:'Junho',entradas:0,gastos:60,saldo:3880},
    {mes:'Julho',entradas:0,gastos:90,saldo:3790},
    {mes:'Agosto',entradas:0,gastos:90,saldo:3700},
    {mes:'Setembro',entradas:0,gastos:50,saldo:3650},
    {mes:'Outubro',entradas:0,gastos:0,saldo:3650},
    {mes:'Novembro',entradas:0,gastos:0,saldo:3650},
    {mes:'Dezembro',entradas:0,gastos:120,saldo:3530}
  ]
};

function mostrarPlaneamento(aba){
  const c=document.getElementById('tabela-planeamento'); c.innerHTML='';
  if(!planeamentoData[aba]) return;
  const t=document.createElement('table');
  const h=document.createElement('tr');
  ['M√™s','Entradas (‚Ç¨)','Gastos (‚Ç¨)','Saldo (‚Ç¨)'].forEach(v=>{
    const th=document.createElement('th'); th.textContent=v; h.appendChild(th);
  });
  t.appendChild(h);
  planeamentoData[aba].forEach(m=>{
    const tr=document.createElement('tr');
    [m.mes,m.entradas.toFixed(2),m.gastos.toFixed(2),m.saldo.toFixed(2)].forEach(v=>{
      const td=document.createElement('td'); td.textContent=v; tr.appendChild(td);
    });
    t.appendChild(tr);
  });
  c.appendChild(t);
}

// ================== INICIALIZA√á√ÉO FINAL ==================
atualizarSaldosLista();
preencherSelectAbas();
preencherFiltroAbas();
mostrarPlaneamento(document.getElementById('planeamento-aba').value);
atualizarSubAbasMensais();
mostrarMovimentosMesAtual();
</script>
</body>
</html>
